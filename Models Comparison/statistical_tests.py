import numpy as np
from scipy.stats import mannwhitneyu

# Replace these dictionaries with your actual mean Dice scores
# Keys: dataset names; values: lists of model scores

## 2024 vs 2025: ============================================================
test_dice_2024 = {
    'BAGLS':  [0.8753, 0.8743, 0.8721, 0.7635, 0.7053, 0.4460, 0.0235, 0.0116],
    'Bolus':  [0.8747, 0.8592, 0.8736, 0.8663, 0.7962, 0.5484, 0.0346, 0.0192],
    'Brain':  [0.9184, 0.8964, 0.8886, 0.8846, 0.7577, 0.1562, 0.0497, 0.0395],
    'Myoma':  [0.8040, 0.7926, 0.7674, 0.2156, 0.0433, 0.0169, 0.0165, 0.0000],
    'Retina': [0.6985, 0.5515, 0.0980, 0.0916, 0.0520, 0.0433, 0.0017, 0.0000],
    'Skin':   [0.9194, 0.9132, 0.8999, 0.8810, 0.8200, 0.7194, 0.4097, 0.3467]
}

val_dice_2024 = {
    'BAGLS':  [1.0048, 0.8553, 0.8136, 0.7450, 0.6174, 0.6111, 0.5048, 0.2750],
    'Bolus':  [1.0622, 0.8579, 0.7997, 0.7651, 0.7127, 0.6248, 0.6166, 0.2666],
    'Brain':  [0.8492, 0.7551, 0.6675, 0.5925, 0.4802, 0.1612, 0.1533, 0.0461],
    'Myoma':  [0.6540, 0.6060, 0.5977, 0.1927, 0.0165, 0.0163, 0.0000, 0.0000],
    'Retina': [0.5551, 0.4992, 0.1164, 0.1157, 0.0518, 0.0211, 0.0001, 0.0000],
    'Skin':   [1.1195, 0.9618, 0.9421, 0.8972, 0.8934, 0.8853, 0.8278, 0.6763]
}


test_dice_2025 = {
    'BAGLS':   [0.9239, 0.9000, 0.8865, 0.8725, 0.8562, 0.8527, 0.8484, 0.8416, 0.8338, 0.8196, 0.7955],
    'Bolus':   [0.8810, 0.8761, 0.8732, 0.8564, 0.8538, 0.8515, 0.8474, 0.8446, 0.8420, 0.7814, 0.7449],
    'Brain':   [0.9574, 0.9302, 0.9093, 0.8724, 0.8360, 0.8329, 0.8131, 0.8049, 0.7808, 0.7785, 0.4667],
    'Myoma':   [0.7224, 0.6928, 0.6915, 0.4804, 0.4747, 0.4520, 0.4207, 0.4155, 0.3469, 0.2802, 0.1353],
    'Retina':  [0.7224, 0.6928, 0.6915, 0.4804, 0.4747, 0.4520, 0.4207, 0.4155, 0.3469, 0.2802, 0.1353],
    'Skin':    [0.9251, 0.9134, 0.9134, 0.9110, 0.9037, 0.9021, 0.8871, 0.8842, 0.8674, 0.8295, 0.8183]
}

val_dice_2025 = {
    'BAGLS':   [0.9046, 0.8536, 0.8466, 0.8047, 0.8033, 0.7920, 0.7872, 0.7808, 0.7737, 0.7317, 0.7143],
    'Bolus':   [0.8678, 0.8536, 0.8408, 0.8248, 0.8242, 0.8222, 0.8062, 0.7926, 0.7513, 0.7051, 0.6539],
    'Brain':   [0.8730, 0.8713, 0.7985, 0.7617, 0.7506, 0.7120, 0.7037, 0.6900, 0.6761, 0.6654, 0.2149],
    'Myoma':   [0.5781, 0.5565, 0.5491, 0.4907, 0.3689, 0.3102, 0.2971, 0.1421, 0.1255, 0.1232, 0.0638],
    'Retina':  [0.5781, 0.5565, 0.5491, 0.4907, 0.3689, 0.3102, 0.2971, 0.1421, 0.1255, 0.1232, 0.0638],
    'Skin':    [0.9113, 0.9042, 0.8877, 0.8859, 0.8857, 0.8769, 0.8735, 0.8708, 0.8700, 0.8257, 0.7829]
}

## Reasoning vs non-reasoning: ========================================================================

# # Reasoning models’ test Dice scores per dataset
# test_dice_2025 = {
#     'BAGLS':  [0.8743, 0.8562, 0.8725, 0.8484, 0.8865, 0.9239, 0.7955, 0.8416, 0.8338, 0.8196],
#     'Bolus':  [0.8592, 0.8538, 0.8564, 0.8474, 0.8732, 0.8810, 0.7449, 0.8446, 0.8420, 0.7814],
#     'Brain':  [0.8886, 0.7577, 0.8724, 0.8131, 0.9302, 0.9574, 0.4667, 0.8329, 0.7808, 0.7785],
#     'Myoma':  [0.8040, 0.2156, 0.4804, 0.7224, 0.6928, 0.4185, 0.2802, 0.4155, 0.3469, 0.1353],
#     'Retina': [0.0518, 0.4992, 0.4804, 0.8184, 0.6928, 0.0916, 0.2802, 0.4207, 0.3469, 0.1353],
#     'Skin':   [0.8853, 0.8972, 0.9037, 0.9251, 0.9134, 0.8810, 0.8183, 0.8871, 0.8674, 0.8295]
# }
#
# # Non-reasoning models’ test Dice scores per dataset
# test_dice_2024= {
#     'BAGLS':  [0.8721, 0.7053, 0.4460, 0.8753, 0.0235, 0.0116, 0.9000, 0.8527, 0.8466],
#     'Bolus':  [0.8736, 0.8663, 0.5484, 0.8747, 0.0346, 0.0192, 0.8761, 0.8564, 0.8732],
#     'Brain':  [0.8964, 0.8846, 0.1562, 0.9184, 0.0497, 0.0395, 0.9302, 0.8329, 0.8724],
#     'Myoma':  [0.7674, 0.0433, 0.0169, 0.7926, 0.0165, 0.0000, 0.6915, 0.4520, 0.7224],
#     'Retina': [0.0001, 0.1164, 0.0916, 0.6985, 0.0980, 0.0520, 0.4804, 0.3469, 0.7224],
#     'Skin':   [0.9132, 0.8810, 0.7194, 0.9194, 0.4097, 0.3467, 0.9021, 0.8295, 0.9037]
# }
#
# # Validation Dice scores for reasoning models per dataset
# val_dice_2025 = {
#     'BAGLS':  [0.8136, 0.8033, 0.8047, 0.8466, 0.8536, 0.9046, 0.7143, 0.7808, 0.7872, 0.7737],
#     'Bolus':  [0.7127, 0.8242, 0.8248, 0.8408, 0.8536, 0.8678, 0.6539, 0.7926, 0.8062, 0.7513],
#     'Brain':  [0.5925, 0.7506, 0.7617, 0.7985, 0.8713, 0.8730, 0.2149, 0.6900, 0.7037, 0.6761],
#     'Myoma':  [0.5977, 0.3689, 0.4907, 0.5491, 0.5565, 0.5781, 0.0638, 0.1421, 0.2971, 0.1255],
#     'Retina': [0.0518, 0.3689, 0.4907, 0.4992, 0.5565, 0.5781, 0.0000, 0.1421, 0.2971, 0.1255],
#     'Skin':   [0.8853, 0.8857, 0.8859, 0.8877, 0.9042, 0.9113, 0.7829, 0.8708, 0.8735, 0.8769]
# }
#
# # Validation Dice scores for non-reasoning models per dataset
# val_dice_2024 = {
#     'BAGLS':  [0.7450, 0.6174, 0.6111, 0.8553, 1.0048, 0.2750, 0.8536, 0.7920, 0.8466],
#     'Bolus':  [0.7651, 0.6248, 0.6166, 0.8579, 1.0622, 0.2666, 0.8536, 0.8222, 0.8248],
#     'Brain':  [0.6675, 0.1612, 0.1533, 0.7551, 0.9435, 0.0461, 0.8713, 0.7120, 0.7985],
#     'Myoma':  [0.6060, 0.0165, 0.0163, 0.1927, 0.7447, 0.0000, 0.5565, 0.3102, 0.5491],
#     'Retina': [0.0001, 0.1164, 0.1157, 0.4992, 0.8184, 0.0000, 0.5565, 0.3102, 0.5491],
#     'Skin':   [0.8934, 0.9618, 0.9421, 0.8972, 1.1195, 0.6763, 0.9042, 0.8769, 0.8877]
# }
## ========================================================================================================
alpha = 0.05
n_tests = len(test_dice_2024)  # six datasets
alpha_corrected = alpha / n_tests

print(f"Bonferroni‐corrected α = {alpha_corrected:.4f}\n")

def run_tests(data2024, data2025, label):
    print(f"== {label} Dice Scores ==")
    for ds in data2024:
        a = data2024[ds]
        b = data2025[ds]
        u, p = mannwhitneyu(b, a, alternative='greater')
        sig = "Yes" if p < alpha_corrected else "No"
        print(f"{ds:6s}: U = {u:5.1f}, p = {p:.4f}, significant? {sig}")
    print()

# Run for test Dice
run_tests(test_dice_2024, test_dice_2025, "Test")

# Run for validation Dice
run_tests(val_dice_2024, val_dice_2025, "Validation")
